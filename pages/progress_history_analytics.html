<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>تاريخ التقدم والتحليلات - Islamic Habits Tracker</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet" />
    <style>
        .arabic-font { font-family: 'Amiri', serif; }
        .gradient-bg { background: linear-gradient(135deg, #4A7C59 0%, #2D5A4F 100%); }
        .islamic-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm0 0c0 11.046 8.954 20 20 20s20-8.954 20-20-8.954-20-20-20-20 8.954-20 20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .chart-container { 
            position: relative; 
            height: 300px; 
            background: linear-gradient(135deg, #f8fffe 0%, #f0f9f7 100%);
            border-radius: 12px;
            overflow: hidden;
        }
        .heatmap-cell {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin: 1px;
            transition: all 0.3s ease;
        }
        .heatmap-cell:hover {
            transform: scale(1.2);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .streak-badge {
            background: linear-gradient(135deg, #7C4DFF, #AF97FF);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .metric-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .trend-line {
            stroke: #4A7C59;
            stroke-width: 3;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .achievement-glow {
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(124, 77, 255, 0.5); }
            to { box-shadow: 0 0 20px rgba(124, 77, 255, 0.8); }
        }
        .swipe-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
        }
        .swipe-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #E5E7EB;
            transition: all 0.3s ease;
        }
        .swipe-dot.active {
            background: #7C4DFF;
            transform: scale(1.2);
        }
        .filter-chip {
            background: #F5F2FF;
            color: #7C4DFF;
            border: 1px solid #D7CBFF;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .filter-chip.active {
            background: #7C4DFF;
            color: white;
        }
        .congratulatory-message {
            background: linear-gradient(135deg, #10B981, #34D399);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin: 16px 0;
        }
    </style>
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fislamicha1172back.builtwithrocket.new&_v=0.1.2"></script>
</head>
<body class="bg-background min-h-screen">
    <!-- Header -->
    <header class="gradient-bg islamic-pattern text-white p-4 shadow-custom-md">
        <div class="flex justify-between items-center max-w-6xl mx-auto">
            <div class="flex items-center gap-3">
                <button id="backBtn" class="p-2 hover:bg-white/10 rounded-lg transition-colors" onclick="window.location.href='daily_habits_dashboard.html'">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h1 class="text-xl font-bold arabic-font">تاريخ التقدم والتحليلات</h1>
            </div>
            <div class="flex items-center gap-3">
                <button id="exportBtn" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                </button>
                <button id="menuBtn" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Filters Section -->
    <section class="max-w-6xl mx-auto p-4">
        <div class="card p-4 mb-6">
            <div class="flex flex-col md:flex-row gap-4 items-start md:items-center justify-between">
                <div class="flex flex-wrap gap-2">
                    <span class="text-sm font-semibold arabic-font mb-2 md:mb-0">فترة التحليل:</span>
                    <button class="filter-chip active" data-period="week">أسبوع</button>
                    <button class="filter-chip" data-period="month">شهر</button>
                    <button class="filter-chip" data-period="quarter">ربع سنة</button>
                    <button class="filter-chip" data-period="year">سنة</button>
                </div>
                <div class="flex flex-wrap gap-2">
                    <span class="text-sm font-semibold arabic-font mb-2 md:mb-0">الفئات:</span>
                    <button class="filter-chip active" data-category="all">الكل</button>
                    <button class="filter-chip" data-category="prayer">الصلاة</button>
                    <button class="filter-chip" data-category="dhikr">الذكر</button>
                    <button class="filter-chip" data-category="quran">القرآن</button>
                    <button class="filter-chip" data-category="charity">الصدقة</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Key Metrics Cards -->
    <section class="max-w-6xl mx-auto p-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="metric-card card p-6 text-center">
                <div class="flex items-center justify-center gap-2 mb-3">
                    <svg class="w-8 h-8 text-accent" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    <h3 class="text-lg font-semibold arabic-font">إجمالي النقاط</h3>
                </div>
                <p class="text-3xl font-bold text-accent mb-2">2,847</p>
                <p class="text-sm text-text-secondary">هذا الشهر</p>
                <div class="mt-3 text-xs text-success">+15% من الشهر الماضي</div>
            </div>

            <div class="metric-card card p-6 text-center">
                <div class="flex items-center justify-center gap-2 mb-3">
                    <svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
                    </svg>
                    <h3 class="text-lg font-semibold arabic-font">أطول سلسلة</h3>
                </div>
                <p class="text-3xl font-bold text-primary mb-2">23</p>
                <p class="text-sm text-text-secondary">يوم متتالي</p>
                <div class="streak-badge mt-3">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                    </svg>
                    رقم قياسي شخصي
                </div>
            </div>

            <div class="metric-card card p-6 text-center">
                <div class="flex items-center justify-center gap-2 mb-3">
                    <svg class="w-8 h-8 text-secondary" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <h3 class="text-lg font-semibold arabic-font">الأكثر انتظاماً</h3>
                </div>
                <p class="text-2xl font-bold text-secondary mb-2">الصلاة</p>
                <p class="text-sm text-text-secondary">94% معدل الإنجاز</p>
                <div class="progress-bar mt-3">
                    <div class="progress-fill" style="width: 94%;"></div>
                </div>
            </div>

            <div class="metric-card card p-6 text-center">
                <div class="flex items-center justify-center gap-2 mb-3">
                    <svg class="w-8 h-8 text-success" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                    <h3 class="text-lg font-semibold arabic-font">التحسن الشهري</h3>
                </div>
                <p class="text-3xl font-bold text-success mb-2">+28%</p>
                <p class="text-sm text-text-secondary">مقارنة بالشهر الماضي</p>
                <div class="mt-3 text-xs text-success">اتجاه تصاعدي ممتاز</div>
            </div>
        </div>
    </section>

    <!-- Congratulatory Messages -->
    <section class="max-w-6xl mx-auto p-4">
        <div class="congratulatory-message achievement-glow">
            <div class="flex items-center justify-center gap-3 mb-2">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                <h3 class="text-lg font-bold arabic-font">مبارك! أفضل أسبوع في انتظام الصلاة</h3>
            </div>
            <p class="arabic-font">حافظت على جميع الصلوات لمدة 7 أيام متتالية - بارك الله فيك!</p>
        </div>
    </section>

    <!-- Charts Section -->
    <section class="max-w-6xl mx-auto p-4">
        <!-- Mobile Swipeable Charts -->
        <div class="md:hidden">
            <div id="mobileChartContainer" class="overflow-hidden">
                <div id="chartSlider" class="flex transition-transform duration-300 ease-in-out">
                    <!-- Monthly Heatmap -->
                    <div class="w-full flex-shrink-0 px-2">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold arabic-font mb-4 text-center">خريطة الإنجاز الشهرية</h3>
                            <div class="chart-container flex items-center justify-center">
                                <div class="grid grid-cols-7 gap-1" id="heatmapGrid">
                                    <!-- Heatmap cells will be generated by JavaScript -->
                                </div>
                            </div>
                            <div class="flex justify-between items-center mt-4 text-sm text-text-secondary">
                                <span>أقل</span>
                                <div class="flex gap-1">
                                    <div class="heatmap-cell bg-gray-100"></div>
                                    <div class="heatmap-cell bg-primary-200"></div>
                                    <div class="heatmap-cell bg-primary-400"></div>
                                    <div class="heatmap-cell bg-primary-600"></div>
                                    <div class="heatmap-cell bg-primary"></div>
                                </div>
                                <span>أكثر</span>
                            </div>
                        </div>
                    </div>

                    <!-- Weekly Trends -->
                    <div class="w-full flex-shrink-0 px-2">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold arabic-font mb-4 text-center">الاتجاهات الأسبوعية</h3>
                            <div class="chart-container flex items-center justify-center">
                                <svg width="100%" height="250" viewBox="0 0 350 250">
                                    <!-- Prayer trend line -->
                                    <path class="trend-line" stroke="#2D5A4F" d="M50,200 L100,180 L150,160 L200,140 L250,120 L300,100"/>
                                    <!-- Dhikr trend line -->
                                    <path class="trend-line" stroke="#4A7C59" d="M50,220 L100,210 L150,190 L200,170 L250,150 L300,130"/>
                                    <!-- Quran trend line -->
                                    <path class="trend-line" stroke="#7C4DFF" d="M50,240 L100,230 L150,220 L200,200 L250,180 L300,160"/>
                                    <!-- Charity trend line -->
                                    <path class="trend-line" stroke="#10B981" d="M50,210 L100,200 L150,185 L200,175 L250,165 L300,155"/>
                                    
                                    <!-- X-axis labels -->
                                    <text x="50" y="245" text-anchor="middle" class="text-xs fill-current text-text-secondary">الأحد</text>
                                    <text x="100" y="245" text-anchor="middle" class="text-xs fill-current text-text-secondary">الاثنين</text>
                                    <text x="150" y="245" text-anchor="middle" class="text-xs fill-current text-text-secondary">الثلاثاء</text>
                                    <text x="200" y="245" text-anchor="middle" class="text-xs fill-current text-text-secondary">الأربعاء</text>
                                    <text x="250" y="245" text-anchor="middle" class="text-xs fill-current text-text-secondary">الخميس</text>
                                    <text x="300" y="245" text-anchor="middle" class="text-xs fill-current text-text-secondary">الجمعة</text>
                                </svg>
                            </div>
                            <div class="flex flex-wrap justify-center gap-4 mt-4 text-sm">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-primary rounded-full"></div>
                                    <span class="arabic-font">الصلاة</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-secondary rounded-full"></div>
                                    <span class="arabic-font">الذكر</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-accent rounded-full"></div>
                                    <span class="arabic-font">القرآن</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-success rounded-full"></div>
                                    <span class="arabic-font">الصدقة</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Streak Analysis -->
                    <div class="w-full flex-shrink-0 px-2">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold arabic-font mb-4 text-center">تحليل السلاسل</h3>
                            <div class="chart-container p-6">
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between p-4 bg-primary-50 rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-6 h-6 text-primary" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                            </svg>
                                            <span class="arabic-font font-semibold">الصلاة</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-primary">23</div>
                                            <div class="text-sm text-text-secondary">يوم</div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-secondary-50 rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-6 h-6 text-secondary" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                            </svg>
                                            <span class="arabic-font font-semibold">الذكر</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-secondary">15</div>
                                            <div class="text-sm text-text-secondary">يوم</div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-accent-50 rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-6 h-6 text-accent" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1zm0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5v11.5z"/>
                                            </svg>
                                            <span class="arabic-font font-semibold">القرآن</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-accent">12</div>
                                            <div class="text-sm text-text-secondary">يوم</div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-success/10 rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-6 h-6 text-success" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                            </svg>
                                            <span class="arabic-font font-semibold">الصدقة</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-success">8</div>
                                            <div class="text-sm text-text-secondary">يوم</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Swipe Indicators -->
            <div class="swipe-indicator">
                <div class="swipe-dot active" data-slide="0"></div>
                <div class="swipe-dot" data-slide="1"></div>
                <div class="swipe-dot" data-slide="2"></div>
            </div>
        </div>

        <!-- Desktop Tabbed Charts -->
        <div class="hidden md:block">
            <div class="card">
                <div class="border-b border-border">
                    <nav class="flex space-x-8 px-6" role="tablist">
                        <button class="tab-button active py-4 px-2 border-b-2 border-accent text-accent font-semibold arabic-font" data-tab="heatmap">
                            خريطة الإنجاز
                        </button>
                        <button class="tab-button py-4 px-2 border-b-2 border-transparent text-text-secondary hover:text-text-primary font-semibold arabic-font" data-tab="trends">
                            الاتجاهات
                        </button>
                        <button class="tab-button py-4 px-2 border-b-2 border-transparent text-text-secondary hover:text-text-primary font-semibold arabic-font" data-tab="streaks">
                            السلاسل
                        </button>
                        <button class="tab-button py-4 px-2 border-b-2 border-transparent text-text-secondary hover:text-text-primary font-semibold arabic-font" data-tab="comparison">
                            المقارنة
                        </button>
                    </nav>
                </div>
                
                <div class="p-6">
                    <!-- Heatmap Tab -->
                    <div id="heatmapTab" class="tab-content">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2">
                                <h3 class="text-xl font-semibold arabic-font mb-4">خريطة الإنجاز الشهرية</h3>
                                <div class="chart-container flex items-center justify-center p-6">
                                    <div class="grid grid-cols-7 gap-2" id="desktopHeatmapGrid">
                                        <!-- Heatmap cells will be generated by JavaScript -->
                                    </div>
                                </div>
                                <div class="flex justify-between items-center mt-4 text-sm text-text-secondary">
                                    <span>أقل نشاط</span>
                                    <div class="flex gap-1">
                                        <div class="w-4 h-4 bg-gray-100 rounded"></div>
                                        <div class="w-4 h-4 bg-primary-200 rounded"></div>
                                        <div class="w-4 h-4 bg-primary-400 rounded"></div>
                                        <div class="w-4 h-4 bg-primary-600 rounded"></div>
                                        <div class="w-4 h-4 bg-primary rounded"></div>
                                    </div>
                                    <span>أكثر نشاط</span>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold arabic-font mb-4">إحصائيات سريعة</h4>
                                <div class="space-y-4">
                                    <div class="p-4 bg-primary-50 rounded-lg">
                                        <div class="text-2xl font-bold text-primary">87%</div>
                                        <div class="text-sm text-text-secondary arabic-font">معدل الإنجاز الشهري</div>
                                    </div>
                                    <div class="p-4 bg-secondary-50 rounded-lg">
                                        <div class="text-2xl font-bold text-secondary">26</div>
                                        <div class="text-sm text-text-secondary arabic-font">أيام نشطة</div>
                                    </div>
                                    <div class="p-4 bg-accent-50 rounded-lg">
                                        <div class="text-2xl font-bold text-accent">4</div>
                                        <div class="text-sm text-text-secondary arabic-font">أيام راحة</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Trends Tab -->
                    <div id="trendsTab" class="tab-content hidden">
                        <h3 class="text-xl font-semibold arabic-font mb-6">تحليل الاتجاهات الأسبوعية</h3>
                        <div class="chart-container">
                            <svg width="100%" height="300" viewBox="0 0 800 300">
                                <!-- Grid lines -->
                                <defs>
                                    <pattern id="grid" width="80" height="30" patternUnits="userSpaceOnUse">
                                        <path d="M 80 0 L 0 0 0 30" fill="none" stroke="#E5E7EB" stroke-width="1"/>
                                    </pattern>
                                </defs>
                                <rect width="100%" height="100%" fill="url(#grid)"/>
                                
                                <!-- Prayer trend line -->
                                <path class="trend-line" stroke="#2D5A4F" d="M100,250 L200,220 L300,190 L400,160 L500,130 L600,100 L700,80"/>
                                <!-- Dhikr trend line -->
                                <path class="trend-line" stroke="#4A7C59" d="M100,270 L200,250 L300,220 L400,190 L500,160 L600,140 L700,120"/>
                                <!-- Quran trend line -->
                                <path class="trend-line" stroke="#7C4DFF" d="M100,280 L200,260 L300,240 L400,210 L500,180 L600,160 L700,140"/>
                                <!-- Charity trend line -->
                                <path class="trend-line" stroke="#10B981" d="M100,260 L200,240 L300,215 L400,190 L500,170 L600,150 L700,130"/>
                                
                                <!-- Data points -->
                                <circle cx="700" cy="80" r="4" fill="#2D5A4F"/>
                                <circle cx="700" cy="120" r="4" fill="#4A7C59"/>
                                <circle cx="700" cy="140" r="4" fill="#7C4DFF"/>
                                <circle cx="700" cy="130" r="4" fill="#10B981"/>
                                
                                <!-- X-axis labels -->
                                <text x="100" y="295" text-anchor="middle" class="text-sm fill-current text-text-secondary arabic-font">الأسبوع 1</text>
                                <text x="200" y="295" text-anchor="middle" class="text-sm fill-current text-text-secondary arabic-font">الأسبوع 2</text>
                                <text x="300" y="295" text-anchor="middle" class="text-sm fill-current text-text-secondary arabic-font">الأسبوع 3</text>
                                <text x="400" y="295" text-anchor="middle" class="text-sm fill-current text-text-secondary arabic-font">الأسبوع 4</text>
                                <text x="500" y="295" text-anchor="middle" class="text-sm fill-current text-text-secondary arabic-font">الأسبوع 5</text>
                                <text x="600" y="295" text-anchor="middle" class="text-sm fill-current text-text-secondary arabic-font">الأسبوع 6</text>
                                <text x="700" y="295" text-anchor="middle" class="text-sm fill-current text-text-secondary arabic-font">الأسبوع 7</text>
                            </svg>
                        </div>
                        <div class="flex flex-wrap justify-center gap-6 mt-6">
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-primary rounded-full"></div>
                                <span class="arabic-font">الصلاة (94%)</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-secondary rounded-full"></div>
                                <span class="arabic-font">الذكر (78%)</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-accent rounded-full"></div>
                                <span class="arabic-font">القرآن (65%)</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-success rounded-full"></div>
                                <span class="arabic-font">الصدقة (82%)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Streaks Tab -->
                    <div id="streaksTab" class="tab-content hidden">
                        <h3 class="text-xl font-semibold arabic-font mb-6">تحليل السلاسل والإنجازات</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold arabic-font">السلاسل الحالية</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-4 bg-primary-50 rounded-lg border-r-4 border-primary">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-6 h-6 text-primary" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                            </svg>
                                            <span class="arabic-font font-semibold">الصلاة</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-primary">23</div>
                                            <div class="text-sm text-text-secondary">يوم متتالي</div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-secondary-50 rounded-lg border-r-4 border-secondary">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-6 h-6 text-secondary" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                            </svg>
                                            <span class="arabic-font font-semibold">الذكر</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-secondary">15</div>
                                            <div class="text-sm text-text-secondary">يوم متتالي</div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-accent-50 rounded-lg border-r-4 border-accent">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-6 h-6 text-accent" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1zm0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5v11.5z"/>
                                            </svg>
                                            <span class="arabic-font font-semibold">القرآن</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-accent">12</div>
                                            <div class="text-sm text-text-secondary">يوم متتالي</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold arabic-font">الأرقام القياسية</h4>
                                <div class="space-y-3">
                                    <div class="p-4 bg-gradient-to-r from-accent-100 to-accent-50 rounded-lg achievement-glow">
                                        <div class="flex items-center gap-3 mb-2">
                                            <svg class="w-6 h-6 text-accent" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                            </svg>
                                            <span class="arabic-font font-bold">أطول سلسلة صلاة</span>
                                        </div>
                                        <div class="text-3xl font-bold text-accent">45 يوم</div>
                                        <div class="text-sm text-text-secondary">رمضان 1445</div>
                                    </div>
                                    
                                    <div class="p-4 bg-gradient-to-r from-success/20 to-success/10 rounded-lg">
                                        <div class="flex items-center gap-3 mb-2">
                                            <svg class="w-6 h-6 text-success" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                            </svg>
                                            <span class="arabic-font font-bold">أكثر نقاط في يوم</span>
                                        </div>
                                        <div class="text-3xl font-bold text-success">192 نقطة</div>
                                        <div class="text-sm text-text-secondary">15 جمادى الآخرة</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Tab -->
                    <div id="comparisonTab" class="tab-content hidden">
                        <h3 class="text-xl font-semibold arabic-font mb-6">مقارنة الأداء الشهري</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="card p-6">
                                <h4 class="text-lg font-semibold arabic-font mb-4">الشهر الحالي مقابل الشهر الماضي</h4>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between p-3 bg-primary-50 rounded-lg">
                                        <span class="arabic-font">الصلاة</span>
                                        <div class="flex items-center gap-3">
                                            <span class="text-sm text-text-secondary">الماضي: 89%</span>
                                            <span class="text-lg font-bold text-primary">94%</span>
                                            <span class="text-xs text-success">+5%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-secondary-50 rounded-lg">
                                        <span class="arabic-font">الذكر</span>
                                        <div class="flex items-center gap-3">
                                            <span class="text-sm text-text-secondary">الماضي: 72%</span>
                                            <span class="text-lg font-bold text-secondary">78%</span>
                                            <span class="text-xs text-success">+6%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-accent-50 rounded-lg">
                                        <span class="arabic-font">القرآن</span>
                                        <div class="flex items-center gap-3">
                                            <span class="text-sm text-text-secondary">الماضي: 58%</span>
                                            <span class="text-lg font-bold text-accent">65%</span>
                                            <span class="text-xs text-success">+7%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-success/10 rounded-lg">
                                        <span class="arabic-font">الصدقة</span>
                                        <div class="flex items-center gap-3">
                                            <span class="text-sm text-text-secondary">الماضي: 85%</span>
                                            <span class="text-lg font-bold text-success">82%</span>
                                            <span class="text-xs text-error">-3%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card p-6">
                                <h4 class="text-lg font-semibold arabic-font mb-4">الإنجازات والتحسينات</h4>
                                <div class="space-y-4">
                                    <div class="p-4 bg-gradient-to-r from-success/20 to-success/10 rounded-lg border-r-4 border-success">
                                        <div class="flex items-center gap-2 mb-2">
                                            <svg class="w-5 h-5 text-success" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                            </svg>
                                            <span class="font-semibold arabic-font">تحسن ملحوظ</span>
                                        </div>
                                        <p class="text-sm text-text-secondary arabic-font">تحسن في قراءة القرآن بنسبة 7% هذا الشهر</p>
                                    </div>
                                    
                                    <div class="p-4 bg-gradient-to-r from-accent/20 to-accent/10 rounded-lg border-r-4 border-accent">
                                        <div class="flex items-center gap-2 mb-2">
                                            <svg class="w-5 h-5 text-accent" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                            </svg>
                                            <span class="font-semibold arabic-font">إنجاز جديد</span>
                                        </div>
                                        <p class="text-sm text-text-secondary arabic-font">وصلت لأطول سلسلة صلاة في تاريخك</p>
                                    </div>
                                    
                                    <div class="p-4 bg-gradient-to-r from-warning/20 to-warning/10 rounded-lg border-r-4 border-warning">
                                        <div class="flex items-center gap-2 mb-2">
                                            <svg class="w-5 h-5 text-warning" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                            </svg>
                                            <span class="font-semibold arabic-font">نقطة تحسين</span>
                                        </div>
                                        <p class="text-sm text-text-secondary arabic-font">انخفاض طفيف في الصدقة، حاول التحسن الشهر القادم</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Export Options Modal (Hidden by default) -->
    <div id="exportModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold arabic-font">تصدير البيانات</h3>
                <button id="closeExportModal" class="p-2 hover:bg-gray-100 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="space-y-3">
                <button class="w-full p-3 text-right bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors arabic-font">
                    تصدير كـ PDF
                </button>
                <button class="w-full p-3 text-right bg-secondary-50 hover:bg-secondary-100 rounded-lg transition-colors arabic-font">
                    تصدير كـ Excel
                </button>
                <button class="w-full p-3 text-right bg-accent-50 hover:bg-accent-100 rounded-lg transition-colors arabic-font">
                    مشاركة التقرير
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Menu (Hidden by default) -->
    <nav id="navigationMenu" class="fixed inset-0 bg-black/50 z-50 hidden">
        <div class="bg-white w-80 h-full shadow-custom-lg transform -translate-x-full transition-transform duration-300" id="menuPanel">
            <div class="p-6 border-b border-border">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-bold arabic-font">القائمة</h2>
                    <button id="closeMenuBtn" class="p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="p-6 space-y-4">
                <a href="daily_habits_dashboard.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-primary-50 transition-colors">
                    <svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                    </svg>
                    <span class="arabic-font">لوحة التحكم</span>
                </a>
                <a href="progress_history_analytics.html" class="flex items-center gap-3 p-3 rounded-lg bg-secondary-50 text-secondary">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"/>
                        <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"/>
                    </svg>
                    <span class="arabic-font font-semibold">تحليل التقدم</span>
                </a>
                <a href="daily_review_summary.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-accent-50 transition-colors">
                    <svg class="w-5 h-5 text-accent" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <span class="arabic-font">المراجعة اليومية</span>
                </a>
                <a href="settings_preferences.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                    <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                    </svg>
                    <span class="arabic-font">الإعدادات</span>
                </a>
            </div>
        </div>
    </nav>

    <script>
        // Initialize analytics data
        let analyticsData = {
            currentStreak: 23,
            bestStreak: 45,
            totalPoints: 2847,
            monthlyCompletion: 87,
            categories: {
                prayer: { current: 94, previous: 89, streak: 23 },
                dhikr: { current: 78, previous: 72, streak: 15 },
                quran: { current: 65, previous: 58, streak: 12 },
                charity: { current: 82, previous: 85, streak: 8 }
            },
            heatmapData: generateHeatmapData()
        };

        // Generate sample heatmap data
        function generateHeatmapData() {
            const data = [];
            const today = new Date();
            const startDate = new Date(today.getFullYear(), today.getMonth(), 1);
            const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            
            for (let i = 0; i < daysInMonth; i++) {
                const date = new Date(startDate);
                date.setDate(i + 1);
                const intensity = Math.floor(Math.random() * 5); // 0-4 intensity levels
                data.push({
                    date: date,
                    intensity: intensity,
                    tasks: Math.floor(Math.random() * 18) + 1,
                    points: Math.floor(Math.random() * 150) + 20
                });
            }
            return data;
        }

        // Generate heatmap
        function generateHeatmap(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            analyticsData.heatmapData.forEach(day => {
                const cell = document.createElement('div');
                cell.className = `heatmap-cell cursor-pointer`;
                
                // Set background color based on intensity
                const intensityColors = [
                    'bg-gray-100',
                    'bg-primary-200',
                    'bg-primary-400',
                    'bg-primary-600',
                    'bg-primary'
                ];
                cell.classList.add(intensityColors[day.intensity]);
                
                // Add tooltip
                cell.title = `${day.date.getDate()} - ${day.tasks} مهام - ${day.points} نقطة`;
                
                // Add click handler for drill-down
                cell.addEventListener('click', () => {
                    showDayDetails(day);
                });
                
                container.appendChild(cell);
            });
        }

        // Show day details (drill-down functionality)
        function showDayDetails(day) {
            alert(`تفاصيل يوم ${day.date.getDate()}:\nالمهام المكتملة: ${day.tasks}\nالنقاط المكتسبة: ${day.points}`);
        }

        // Mobile chart swiping functionality
        let currentSlide = 0;
        const totalSlides = 3;

        function updateSlideIndicators() {
            document.querySelectorAll('.swipe-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
        }

        function slideToChart(slideIndex) {
            currentSlide = slideIndex;
            const slider = document.getElementById('chartSlider');
            if (slider) {
                slider.style.transform = `translateX(-${currentSlide * 100}%)`;
                updateSlideIndicators();
            }
        }

        // Touch/swipe handling for mobile
        let startX = 0;
        let currentX = 0;
        let isDragging = false;

        function setupMobileSwipe() {
            const container = document.getElementById('mobileChartContainer');
            if (!container) return;

            container.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
            });

            container.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
                e.preventDefault();
            });

            container.addEventListener('touchend', () => {
                if (!isDragging) return;
                isDragging = false;
                
                const diff = startX - currentX;
                const threshold = 50;
                
                if (Math.abs(diff) > threshold) {
                    if (diff > 0 && currentSlide < totalSlides - 1) {
                        slideToChart(currentSlide + 1);
                    } else if (diff < 0 && currentSlide > 0) {
                        slideToChart(currentSlide - 1);
                    }
                }
            });

            // Add click handlers to swipe dots
            document.querySelectorAll('.swipe-dot').forEach((dot, index) => {
                dot.addEventListener('click', () => slideToChart(index));
            });
        }

        // Desktop tab functionality
        function setupDesktopTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;
                    
                    // Update button states
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active', 'border-accent', 'text-accent');
                        btn.classList.add('border-transparent', 'text-text-secondary');
                    });
                    button.classList.add('active', 'border-accent', 'text-accent');
                    button.classList.remove('border-transparent', 'text-text-secondary');
                    
                    // Update content visibility
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(targetTab + 'Tab').classList.remove('hidden');
                });
            });
        }

        // Filter functionality
        function setupFilters() {
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    const filterType = chip.dataset.period || chip.dataset.category;
                    const filterGroup = chip.dataset.period ? 'period' : 'category';
                    
                    // Update active state within the same group
                    document.querySelectorAll(`[data-${filterGroup}]`).forEach(c => {
                        c.classList.remove('active');
                    });
                    chip.classList.add('active');
                    
                    // Apply filter (in a real app, this would update the data)
                    console.log(`Filtering by ${filterGroup}: ${filterType}`);
                    
                    // Simulate data update
                    setTimeout(() => {
                        generateHeatmap('heatmapGrid');
                        generateHeatmap('desktopHeatmapGrid');
                    }, 300);
                });
            });
        }

        // Export functionality
        function setupExportModal() {
            const exportBtn = document.getElementById('exportBtn');
            const exportModal = document.getElementById('exportModal');
            const closeExportModal = document.getElementById('closeExportModal');

            exportBtn.addEventListener('click', () => {
                exportModal.classList.remove('hidden');
            });

            closeExportModal.addEventListener('click', () => {
                exportModal.classList.add('hidden');
            });

            exportModal.addEventListener('click', (e) => {
                if (e.target === exportModal) {
                    exportModal.classList.add('hidden');
                }
            });

            // Export options
            exportModal.querySelectorAll('button:not(#closeExportModal)').forEach(btn => {
                btn.addEventListener('click', () => {
                    const exportType = btn.textContent.trim();
                    alert(`تصدير البيانات كـ ${exportType} - قريباً!`);
                    exportModal.classList.add('hidden');
                });
            });
        }

        // Menu functionality
        function setupMenu() {
            const menuBtn = document.getElementById('menuBtn');
            const closeMenuBtn = document.getElementById('closeMenuBtn');
            const navigationMenu = document.getElementById('navigationMenu');
            const menuPanel = document.getElementById('menuPanel');

            menuBtn.addEventListener('click', () => {
                navigationMenu.classList.remove('hidden');
                setTimeout(() => {
                    menuPanel.classList.remove('-translate-x-full');
                }, 10);
            });

            closeMenuBtn.addEventListener('click', closeMenu);
            navigationMenu.addEventListener('click', (e) => {
                if (e.target === navigationMenu) {
                    closeMenu();
                }
            });

            function closeMenu() {
                menuPanel.classList.add('-translate-x-full');
                setTimeout(() => {
                    navigationMenu.classList.add('hidden');
                }, 300);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            generateHeatmap('heatmapGrid');
            generateHeatmap('desktopHeatmapGrid');
            setupMobileSwipe();
            setupDesktopTabs();
            setupFilters();
            setupExportModal();
            setupMenu();
            
            // Load saved data
            const savedData = localStorage.getItem('islamicHabitsAnalytics');
            if (savedData) {
                analyticsData = { ...analyticsData, ...JSON.parse(savedData) };
            }
        });

        // Save analytics data
        function saveAnalyticsData() {
            localStorage.setItem('islamicHabitsAnalytics', JSON.stringify(analyticsData));
        }

        // Auto-save data periodically
        setInterval(saveAnalyticsData, 30000); // Save every 30 seconds
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>