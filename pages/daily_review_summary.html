<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>مراجعة يومية - Islamic Habits Tracker</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet" />
    <style>
        .arabic-font { font-family: 'Amiri', serif; }
        .gradient-bg { background: linear-gradient(135deg, #4A7C59 0%, #2D5A4F 100%); }
        .islamic-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm0 0c0 11.046 8.954 20 20 20s20-8.954 20-20-8.954-20-20-20-20 8.954-20 20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .circular-progress {
            position: relative;
            width: 120px;
            height: 120px;
        }
        .circular-progress svg {
            transform: rotate(-90deg);
        }
        .progress-circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dasharray 1s ease-in-out;
        }
        .progress-bg {
            stroke: #E5E7EB;
        }
        .progress-fill {
            stroke: url(#progressGradient);
            stroke-dasharray: 0 377;
            animation: progressAnimation 2s ease-out forwards;
        }
        @keyframes progressAnimation {
            to {
                stroke-dasharray: 75 377;
            }
        }
        .reflection-textarea {
            min-height: 120px;
            resize: vertical;
        }
        .streak-counter {
            background: linear-gradient(135deg, #7C4DFF 0%, #6341CC 100%);
        }
        .chart-bar {
            transition: width 1s ease-out;
        }
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .goal-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #E5E7EB;
            outline: none;
        }
        .goal-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #7C4DFF;
            cursor: pointer;
        }
        .goal-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #7C4DFF;
            cursor: pointer;
            border: none;
        }
    </style>
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fislamicha1172back.builtwithrocket.new&_v=0.1.2"></script>
</head>
<body class="bg-background min-h-screen">
    <!-- Header -->
    <header class="gradient-bg islamic-pattern text-white p-4 shadow-custom-md">
        <div class="flex justify-between items-center max-w-6xl mx-auto">
            <div class="flex items-center gap-3">
                <button onclick="window.location.href='daily_habits_dashboard.html'" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h1 class="text-xl font-bold arabic-font">المراجعة اليومية</h1>
            </div>
            <div class="text-right arabic-font">
                <p class="text-sm opacity-90">التاريخ الهجري</p>
                <p class="font-semibold">٢٥ جمادى الآخرة ١٤٤٦</p>
                <p class="text-xs opacity-75">٢٥ يناير ٢٠٢٥</p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto p-4 space-y-6">
        <!-- Progress Overview Section -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Overall Progress -->
            <div class="card p-6 text-center fade-in-up" style="animation-delay: 0.1s;">
                <h2 class="text-xl font-bold arabic-font mb-6">التقدم العام</h2>
                <div class="flex justify-center mb-4">
                    <div class="circular-progress">
                        <svg width="120" height="120">
                            <defs>
                                <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#2D5A4F"/>
                                    <stop offset="100%" style="stop-color:#4A7C59"/>
                                </linearGradient>
                            </defs>
                            <circle class="progress-circle progress-bg" cx="60" cy="60" r="52"/>
                            <circle class="progress-circle progress-fill" cx="60" cy="60" r="52"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-primary" id="overallProgress">19.8%</div>
                                <div class="text-sm text-text-secondary arabic-font">مكتمل</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold text-accent" id="totalPoints">38</div>
                        <div class="text-sm text-text-secondary arabic-font">النقاط</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-secondary" id="completedTasks">3/18</div>
                        <div class="text-sm text-text-secondary arabic-font">المهام</div>
                    </div>
                </div>
            </div>

            <!-- Category Progress -->
            <div class="card p-6 fade-in-up" style="animation-delay: 0.2s;">
                <h2 class="text-xl font-bold arabic-font mb-6">تقدم الفئات</h2>
                <div class="space-y-4">
                    <!-- Prayer Progress -->
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6l5.25 3.15-.75 1.23L11 13V7z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="arabic-font font-semibold">الصلاة</span>
                                <span class="text-sm text-text-secondary">1/5</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill chart-bar" style="width: 20%;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Dhikr Progress -->
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-secondary-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-secondary" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="arabic-font font-semibold">الذكر</span>
                                <span class="text-sm text-text-secondary">0/7</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill chart-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Quran Progress -->
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-accent-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-accent" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1zm0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5v11.5z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="arabic-font font-semibold">القرآن</span>
                                <span class="text-sm text-text-secondary">0/3</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill chart-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Charity Progress -->
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-success" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="arabic-font font-semibold">الصدقة</span>
                                <span class="text-sm text-text-secondary">1/1</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill chart-bar" style="width: 100%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Weekly Progress & Streak -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Weekly Trend -->
            <div class="card p-6 fade-in-up" style="animation-delay: 0.3s;">
                <h2 class="text-xl font-bold arabic-font mb-6">الاتجاه الأسبوعي</h2>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="arabic-font">السبت</span>
                        <div class="flex items-center gap-2">
                            <div class="progress-bar w-24">
                                <div class="progress-fill" style="width: 85%;"></div>
                            </div>
                            <span class="text-sm font-semibold">85%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="arabic-font">الأحد</span>
                        <div class="flex items-center gap-2">
                            <div class="progress-bar w-24">
                                <div class="progress-fill" style="width: 92%;"></div>
                            </div>
                            <span class="text-sm font-semibold">92%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="arabic-font">الاثنين</span>
                        <div class="flex items-center gap-2">
                            <div class="progress-bar w-24">
                                <div class="progress-fill" style="width: 78%;"></div>
                            </div>
                            <span class="text-sm font-semibold">78%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="arabic-font">الثلاثاء</span>
                        <div class="flex items-center gap-2">
                            <div class="progress-bar w-24">
                                <div class="progress-fill" style="width: 88%;"></div>
                            </div>
                            <span class="text-sm font-semibold">88%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="arabic-font">الأربعاء</span>
                        <div class="flex items-center gap-2">
                            <div class="progress-bar w-24">
                                <div class="progress-fill" style="width: 95%;"></div>
                            </div>
                            <span class="text-sm font-semibold">95%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="arabic-font">الخميس</span>
                        <div class="flex items-center gap-2">
                            <div class="progress-bar w-24">
                                <div class="progress-fill" style="width: 82%;"></div>
                            </div>
                            <span class="text-sm font-semibold">82%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center font-bold">
                        <span class="arabic-font">الجمعة (اليوم)</span>
                        <div class="flex items-center gap-2">
                            <div class="progress-bar w-24">
                                <div class="progress-fill" style="width: 19.8%;"></div>
                            </div>
                            <span class="text-sm font-semibold">19.8%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Streak Counter -->
            <div class="card p-6 fade-in-up" style="animation-delay: 0.4s;">
                <h2 class="text-xl font-bold arabic-font mb-6">إحصائيات التحفيز</h2>
                <div class="space-y-6">
                    <div class="text-center">
                        <div class="streak-counter text-white p-6 rounded-lg mb-4">
                            <div class="text-3xl font-bold mb-2">7</div>
                            <div class="arabic-font">أيام متتالية</div>
                        </div>
                        <p class="text-sm text-text-secondary arabic-font">أطول سلسلة إنجاز</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div class="bg-primary-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-primary mb-1">156</div>
                            <div class="text-sm text-text-secondary arabic-font">إجمالي النقاط</div>
                        </div>
                        <div class="bg-secondary-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-secondary mb-1">23</div>
                            <div class="text-sm text-text-secondary arabic-font">أيام نشطة</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reflection Section -->
        <section class="card p-6 fade-in-up" style="animation-delay: 0.5s;">
            <h2 class="text-xl font-bold arabic-font mb-6">التأمل والتفكر</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-semibold arabic-font mb-2">التجارب الروحية اليوم</label>
                    <textarea class="w-full p-4 border border-border rounded-lg reflection-textarea arabic-font text-right resize-vertical focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="شاركنا تجاربك الروحية وما تعلمته اليوم..." id="spiritualExperience"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-semibold arabic-font mb-2">التحديات التي واجهتها</label>
                    <textarea class="w-full p-4 border border-border rounded-lg reflection-textarea arabic-font text-right resize-vertical focus:ring-2 focus:ring-secondary focus:border-transparent" placeholder="ما هي التحديات التي واجهتها في أداء عباداتك؟" id="challenges"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-semibold arabic-font mb-2">أهداف الغد</label>
                    <textarea class="w-full p-4 border border-border rounded-lg reflection-textarea arabic-font text-right resize-vertical focus:ring-2 focus:ring-accent focus:border-transparent" placeholder="ما هي أهدافك الروحية لليوم القادم؟" id="tomorrowGoals"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-semibold arabic-font mb-2">دعاء أو ذكر مفضل</label>
                    <textarea class="w-full p-4 border border-border rounded-lg reflection-textarea arabic-font text-right resize-vertical focus:ring-2 focus:ring-success focus:border-transparent" placeholder="شاركنا دعاءً أو ذكراً أثر في قلبك اليوم..." id="favoriteSupplication"></textarea>
                </div>
            </div>
        </section>

        <!-- Goal Setting for Tomorrow -->
        <section class="card p-6 fade-in-up" style="animation-delay: 0.6s;">
            <h2 class="text-xl font-bold arabic-font mb-6">تحديد أهداف الغد</h2>
            <div class="space-y-6">
                <div>
                    <div class="flex justify-between items-center mb-3">
                        <label class="text-sm font-semibold arabic-font">هدف الصلاة</label>
                        <span class="text-sm text-accent font-bold" id="prayerGoalValue">5/5</span>
                    </div>
                    <input type="range" min="1" max="5" value="5" class="goal-slider w-full" id="prayerGoal" />
                </div>
                
                <div>
                    <div class="flex justify-between items-center mb-3">
                        <label class="text-sm font-semibold arabic-font">هدف الذكر</label>
                        <span class="text-sm text-accent font-bold" id="dhikrGoalValue">7/7</span>
                    </div>
                    <input type="range" min="1" max="7" value="7" class="goal-slider w-full" id="dhikrGoal" />
                </div>
                
                <div>
                    <div class="flex justify-between items-center mb-3">
                        <label class="text-sm font-semibold arabic-font">هدف القرآن</label>
                        <span class="text-sm text-accent font-bold" id="quranGoalValue">3/3</span>
                    </div>
                    <input type="range" min="1" max="3" value="3" class="goal-slider w-full" id="quranGoal" />
                </div>
            </div>
        </section>

        <!-- Action Buttons -->
        <section class="flex flex-col sm:flex-row gap-4 justify-center items-center mt-8 fade-in-up" style="animation-delay: 0.7s;">
            <button class="btn btn-primary px-6 py-3 arabic-font shadow-custom-lg hover:shadow-custom-md transform hover:scale-105 transition-all duration-300" onclick="shareProgress()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/>
                </svg>
                مشاركة التقدم
            </button>
            
            <button class="btn btn-secondary px-6 py-3 arabic-font shadow-custom-lg hover:shadow-custom-md transform hover:scale-105 transition-all duration-300" onclick="exportSummary()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
                تصدير الملخص
            </button>
            
            <button class="btn btn-accent px-6 py-3 arabic-font shadow-custom-lg hover:shadow-custom-md transform hover:scale-105 transition-all duration-300" onclick="resetForNewDay()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                </svg>
                بدء يوم جديد
            </button>
            
            <button class="btn bg-gray-100 text-text-primary hover:bg-gray-200 px-6 py-3 arabic-font shadow-custom-lg hover:shadow-custom-md transform hover:scale-105 transition-all duration-300" onclick="window.location.href='daily_habits_dashboard.html'">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                </svg>
                العودة للوحة التحكم
            </button>
        </section>
    </main>

    <script>
        // Load data from localStorage
        function loadReviewData() {
            const saved = localStorage.getItem('islamicHabitsData');
            if (saved) {
                const data = JSON.parse(saved);
                
                // Update progress displays
                document.getElementById('totalPoints').textContent = data.points || 38;
                document.getElementById('completedTasks').textContent = `${data.completedTasks || 3}/18`;
                
                const percentage = ((data.completedTasks || 3) / 18 * 100).toFixed(1);
                document.getElementById('overallProgress').textContent = percentage + '%';
                
                // Load saved reflections
                const reflections = JSON.parse(localStorage.getItem('dailyReflections') || '{}');
                const today = new Date().toDateString();
                
                if (reflections[today]) {
                    document.getElementById('spiritualExperience').value = reflections[today].spiritual || '';
                    document.getElementById('challenges').value = reflections[today].challenges || '';
                    document.getElementById('tomorrowGoals').value = reflections[today].goals || '';
                    document.getElementById('favoriteSupplication').value = reflections[today].supplication || '';
                }
            }
        }

        // Save reflections
        function saveReflections() {
            const reflections = JSON.parse(localStorage.getItem('dailyReflections') || '{}');
            const today = new Date().toDateString();
            
            reflections[today] = {
                spiritual: document.getElementById('spiritualExperience').value,
                challenges: document.getElementById('challenges').value,
                goals: document.getElementById('tomorrowGoals').value,
                supplication: document.getElementById('favoriteSupplication').value,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('dailyReflections', JSON.stringify(reflections));
        }

        // Goal slider handlers
        function setupGoalSliders() {
            const sliders = [
                { id: 'prayerGoal', valueId: 'prayerGoalValue', max: 5 },
                { id: 'dhikrGoal', valueId: 'dhikrGoalValue', max: 7 },
                { id: 'quranGoal', valueId: 'quranGoalValue', max: 3 }
            ];

            sliders.forEach(slider => {
                const element = document.getElementById(slider.id);
                const valueElement = document.getElementById(slider.valueId);
                
                element.addEventListener('input', (e) => {
                    valueElement.textContent = `${e.target.value}/${slider.max}`;
                });
            });
        }

        // Action button functions
        function shareProgress() {
            const data = JSON.parse(localStorage.getItem('islamicHabitsData') || '{}');
            const percentage = ((data.completedTasks || 3) / 18 * 100).toFixed(1);
            
            if (navigator.share) {
                navigator.share({
                    title: 'تقدمي في العادات الإسلامية',
                    text: `أكملت ${percentage}% من مهامي الروحية اليوم! 🌙`,
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                const text = `أكملت ${percentage}% من مهامي الروحية اليوم! 🌙`;
                navigator.clipboard.writeText(text).then(() => {
                    alert('تم نسخ النص للمشاركة!');
                });
            }
        }

        function exportSummary() {
            const data = JSON.parse(localStorage.getItem('islamicHabitsData') || '{}');
            const reflections = JSON.parse(localStorage.getItem('dailyReflections') || '{}');
            const today = new Date().toDateString();
            
            const summary = {
                date: today,
                progress: data,
                reflections: reflections[today] || {},
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(summary, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `islamic-habits-summary-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function resetForNewDay() {
            if (confirm('هل أنت متأكد من أنك تريد بدء يوم جديد؟ سيتم إعادة تعيين جميع المهام.')) {
                // Save current day's data to history
                const currentData = JSON.parse(localStorage.getItem('islamicHabitsData') || '{}');
                const history = JSON.parse(localStorage.getItem('habitsHistory') || '[]');
                
                history.push({
                    date: new Date().toDateString(),
                    data: currentData,
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem('habitsHistory', JSON.stringify(history));
                
                // Reset current day data
                const resetData = {
                    points: 0,
                    totalPoints: 192,
                    completedTasks: 0,
                    totalTasks: 18,
                    tasks: {
                        fajr: false,
                        dhuhr: false,
                        asr: false,
                        maghrib: false,
                        isha: false,
                        'morning-adhkar': false,
                        'evening-adhkar': false,
                        'istighfar': false,
                        'quran-reading': false,
                        'quran-memorization': false,
                        'quran-reflection': false,
                        'daily-charity': false
                    }
                };
                
                localStorage.setItem('islamicHabitsData', JSON.stringify(resetData));
                
                // Redirect to dashboard
                window.location.href = 'daily_habits_dashboard.html';
            }
        }

        // Auto-save reflections
        function setupAutoSave() {
            const textareas = ['spiritualExperience', 'challenges', 'tomorrowGoals', 'favoriteSupplication'];
            
            textareas.forEach(id => {
                const element = document.getElementById(id);
                element.addEventListener('input', () => {
                    clearTimeout(element.saveTimeout);
                    element.saveTimeout = setTimeout(saveReflections, 1000);
                });
            });
        }

        // Initialize animations
        function initializeAnimations() {
            const elements = document.querySelectorAll('.fade-in-up');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animationPlayState = 'running';
                    }
                });
            });

            elements.forEach(el => {
                observer.observe(el);
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            loadReviewData();
            setupGoalSliders();
            setupAutoSave();
            initializeAnimations();
            
            // Animate progress bars
            setTimeout(() => {
                document.querySelectorAll('.chart-bar').forEach(bar => {
                    bar.style.animationDelay = '0.5s';
                });
            }, 500);
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>